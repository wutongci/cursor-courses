# ç¬¬åä¸€ç« ï¼šé«˜æ•ˆå¼€å‘å®è·µ

è¿˜è®°å¾—æˆ‘åˆšå¼€å§‹ä½¿ç”¨ AI ç¼–ç¨‹åŠ©æ‰‹çš„æ—¶å€™ï¼Œå°±åƒç¬¬ä¸€æ¬¡å­¦ä¼šéª‘è‡ªè¡Œè½¦çš„å°å­©ï¼Œæ—¢å…´å¥‹åˆå¿å¿‘ã€‚é‚£æ—¶å€™ï¼Œæˆ‘æ€»æ˜¯æœŸå¾…ç€ AI èƒ½ä¸€æ¬¡æ€§ç”Ÿæˆå®Œç¾çš„ä»£ç ï¼Œç»“æœå¾€å¾€æ˜¯å¾—åˆ°ä¸€å †"å››ä¸åƒ"çš„ä»£ç ã€‚ç»è¿‡æ— æ•°æ¬¡çš„å°è¯•å’Œå¤±è´¥ï¼Œæˆ‘ç»ˆäºæ‰¾åˆ°äº†å’Œ AI æ„‰å¿«å…±èˆçš„èŠ‚å¥ã€‚ä»Šå¤©ï¼Œå°±è®©æˆ‘å¸¦ä½ èµ°è¿›æˆ‘çš„ AI ç¼–ç¨‹å®éªŒå®¤ï¼Œåˆ†äº«ä¸€äº›æ¥è‡ªå®æˆ˜çš„ç‹¬å®¶ç§˜ç¬ˆã€‚

## 11.1 ä»"è°ƒæ•™"AI å¼€å§‹è¯´èµ·

è®°å¾—å‡ ä¸ªæœˆå‰ï¼Œæˆ‘ä»¬å›¢é˜Ÿæ¥åˆ°ä¸€ä¸ªæœ‰è¶£çš„é¡¹ç›®ï¼šåœ¨ä¸¤ä¸ªæœˆå†…å¼€å‘ä¸€ä¸ªä¼ä¸šçº§æ™ºèƒ½å®¢æœç³»ç»Ÿã€‚å¸‚é¢ä¸Šæœ‰ä¸€ä¸ªå¼€æºçš„èŠå¤©æœºå™¨äººé¡¹ç›®å·²ç»å‘å±•äº†7å¹´ï¼Œæœ€è¿‘ä¸¤å¹´ä¹ŸåŠ å…¥äº† AI åŠŸèƒ½ã€‚è™½ç„¶æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªé¡¹ç›®çš„ä»£ç ï¼ˆå› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±çš„æŠ€æœ¯æ ˆå’Œè®¾è®¡è§„èŒƒï¼‰ï¼Œä½†å®ƒçš„æ¶æ„è®¾è®¡å’Œä¸€äº›æœ€ä½³å®è·µç¡®å®å€¼å¾—å‚è€ƒã€‚å¯¹äºè¿™ä¸ªä»»åŠ¡åªç»™äº†ä¸¤ä¸ªäººçš„ç ”å‘èµ„æºï¼Œå¯¹äºä¸¤ä¸ªäººçš„å°å›¢é˜Ÿæ¥è¯´ï¼Œå¦‚ä½•åœ¨çŸ­æ—¶é—´å†…è®¾è®¡å¹¶å®ç°ä¸€ä¸ªç¨³å®šå¯é çš„ç³»ç»Ÿä»æ˜¯ä¸å°çš„æŒ‘æˆ˜ã€‚

### 11.1.1 ç ´å±€ä¹‹é“

åœ¨ç ”ç©¶äº†å¼€æºé¡¹ç›®çš„æ¶æ„è®¾è®¡åï¼Œæˆ‘å¼€å§‹æ€è€ƒå¦‚ä½•ç»“åˆæˆ‘ä»¬è‡ªå·±çš„æŠ€æœ¯æ ˆå’Œè®¾è®¡è§„èŒƒæ¥è§„åˆ’è¿™ä¸ªé¡¹ç›®ã€‚è¿™æ—¶æˆ‘æƒ³åˆ°ï¼šä¸ºä»€ä¹ˆä¸è®© AI æ¥ååŠ©æˆ‘ä»¬è¿›è¡ŒæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡å‘¢ï¼Ÿ

äºæ˜¯æˆ‘å¼€å§‹è¿™æ ·åšï¼š

```markdown
1. é¡¹ç›®è§„åˆ’ï¼š
   - æŠ€æœ¯æ ˆé€‰å‹ â†’ ç»“åˆå…¬å¸è§„èŒƒï¼Œç¡®å®šå¼€å‘æ¡†æ¶å’Œå·¥å…·
   - æ¶æ„è®¾è®¡ â†’ å‚è€ƒå¼€æºé¡¹ç›®çš„ä¼˜ç‚¹ï¼Œç»“åˆè‡ªèº«éœ€æ±‚è®¾è®¡æ¶æ„
   - æ ¸å¿ƒåŠŸèƒ½ â†’ å®ç°å¯¹è¯å¼•æ“ã€çŸ¥è¯†åº“ç®¡ç†ã€ä¼šè¯ç®¡ç†ç­‰æ¨¡å—
   - æ€§èƒ½ä¼˜åŒ– â†’ è®¾è®¡ç¼“å­˜ç­–ç•¥ã€å¹¶å‘æ§åˆ¶ç­‰æœºåˆ¶
   - ç›‘æ§å‘Šè­¦ â†’ å®ç°ç³»ç»Ÿç›‘æ§ã€é”™è¯¯è¿½è¸ªç­‰è¿ç»´åŠŸèƒ½
```

æ¯ä¸ªåŠŸèƒ½ç‚¹ï¼Œæˆ‘éƒ½ä¼šå…ˆå’Œ AI è®¨è®ºå®ç°æ€è·¯ï¼Œå°±åƒå’Œä¸€ä¸ªç»éªŒä¸°å¯Œçš„è€ç¨‹åºå‘˜äº¤æµã€‚æ¯”å¦‚è®¨è®ºå¯¹è¯å¼•æ“è®¾è®¡æ—¶ï¼š

```javascript
// ğŸ¤” æˆ‘ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„å¯¹è¯å¼•æ“ï¼Ÿ

// ğŸ¤– AIï¼šè®©æˆ‘ä»¬ä»é›¶å¼€å§‹è®¾è®¡ï¼š
const ChatEngine = {
    async handleMessage(req, res) {
        try {
            // 1. è¯·æ±‚é¢„å¤„ç†
            const { message, sessionId } = req.body;
            const startTime = Date.now();
            
            // 2. æ£€æŸ¥ç¼“å­˜
            const cachedResponse = await this.checkCache(message, sessionId);
            if (cachedResponse) {
                this.logResponse(startTime, 'cache_hit');
                return res.json(cachedResponse);
            }

            // 3. ä¸Šä¸‹æ–‡ç®¡ç†
            const context = await this.contextManager.getContext(sessionId);
            
            // 4. æ„å›¾è¯†åˆ«
            const intent = await this.intentClassifier.classify(message);
            
            // 5. æ ¹æ®æ„å›¾é€‰æ‹©å¤„ç†ç­–ç•¥
            let response;
            if (intent.type === 'faq') {
                response = await this.knowledgeBase.search(message);
            } else if (intent.type === 'task') {
                response = await this.taskHandler.process(message, context);
            } else {
                response = await this.aiModel.generate(message, context);
            }

            // 6. æ›´æ–°ä¸Šä¸‹æ–‡
            await this.contextManager.updateContext(sessionId, {
                lastMessage: message,
                lastResponse: response,
                lastIntent: intent
            });

            // 7. ç¼“å­˜å“åº”
            await this.cacheResponse(message, sessionId, response);
            
            // 8. æ€§èƒ½ç›‘æ§
            this.logResponse(startTime, 'normal');
            
            return res.json(response);
        } catch (err) {
            this.errorHandler(err, res);
        }
    }
};
```

### 11.1.2 æŠ€æœ¯åˆ›æ–°

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸ä»…æŒ‰æ—¶å®Œæˆäº†é¡¹ç›®ï¼Œè¿˜åœ¨æŸäº›æ–¹é¢è¶…è¶Šäº†å‚è€ƒçš„å¼€æºé¡¹ç›®ã€‚æ¯”å¦‚ï¼š

```javascript
// å¼€æºé¡¹ç›®çš„å¸¸è§å®ç°
class BasicChatbot {
    async reply(message) {
        // ç®€å•çš„æ¨¡å‹è°ƒç”¨
        return await this.model.generate(message);
    }
}

// æˆ‘ä»¬çš„æ”¹è¿›å®ç°
class SmartChatEngine {
    async reply(message, context) {
        // 1. æ„å›¾è¯†åˆ«
        const intent = await this.classifier.detect(message);
        
        // 2. åŠ¨æ€è·¯ç”±
        const handler = this.getHandler(intent);
        
        // 3. ä¸Šä¸‹æ–‡å¢å¼º
        const enhancedContext = await this.contextEnhancer.process(context);
        
        // 4. æ™ºèƒ½å¤„ç†
        const response = await handler.process(message, enhancedContext);
        
        // 5. è´¨é‡æ§åˆ¶
        await this.qualityChecker.validate(response);
        
        return response;
    }
}
```

### 11.1.3 æ¶æ„åˆ›æ–°

åœ¨è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å½¢æˆäº†ä¸€äº›ç‹¬ç‰¹çš„æœ€ä½³å®è·µï¼š

```javascript
// 1. æ¨¡å—åŒ–çš„ä¸Šä¸‹æ–‡ç®¡ç†
const ContextManager = {
    async get(sessionId) {
        const context = await redis.get(`ctx:${sessionId}`);
        return this.enhance(context);
    },
    
    // ä¸Šä¸‹æ–‡å¢å¼º
    async enhance(context) {
        return {
            ...context,
            timestamp: Date.now(),
            enriched: await this.enrichContext(context)
        };
    },
    
    // æ™ºèƒ½è¿‡æœŸ
    async update(sessionId, context) {
        const ttl = this.calculateTTL(context);
        await redis.set(
            `ctx:${sessionId}`,
            JSON.stringify(context),
            'EX',
            ttl
        );
    }
};

// 2. æ™ºèƒ½åˆ†å‘ç³»ç»Ÿ
const MessageDispatcher = {
    async dispatch(message) {
        // æ„å›¾è¯†åˆ«
        const intent = await this.classifier.detect(message);
        
        // è´Ÿè½½å‡è¡¡
        const handler = await this.loadBalancer.select(intent);
        
        // å¤„ç†å¹¶ç›‘æ§
        const startTime = Date.now();
        try {
            const response = await handler.process(message);
            this.monitor.record(intent, Date.now() - startTime);
            return response;
        } catch (error) {
            this.failover.handle(error, message);
            throw error;
        }
    }
};

// 3. è‡ªé€‚åº”é™æµ
const AdaptiveRateLimiter = {
    async shouldLimit(userId) {
        const stats = await this.getStats(userId);
        return this.algorithm.evaluate({
            requestRate: stats.requestRate,
            errorRate: stats.errorRate,
            systemLoad: await this.getSystemLoad()
        });
    },
    
    // åŠ¨æ€è°ƒæ•´é™åˆ¶
    async updateLimits() {
        const metrics = await this.getSystemMetrics();
        this.limits = this.algorithm.calculateLimits(metrics);
    }
};
```

## 11.2 å®æˆ˜ç»éªŒåˆ†äº«

åœ¨ä½¿ç”¨ AI çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ€»ç»“å‡ºäº†ä¸€ä¸ª"ä¸‰æ­¥èµ°"ç­–ç•¥ï¼š

### 11.2.1 ç¬¬ä¸€æ­¥ï¼šè®© AI ç†è§£ä½ çš„æ„å›¾

ä¸è¦ä¸€ä¸Šæ¥å°±ç”©éœ€æ±‚ï¼Œè€Œæ˜¯è¦åƒè®²æ•…äº‹ä¸€æ ·æè¿°ä½ è¦è§£å†³çš„é—®é¢˜ï¼š

```javascript
// æ¯”å¦‚æˆ‘è¦å®ç°ä¸€ä¸ªå•†å“æœç´¢åŠŸèƒ½ï¼Œæˆ‘ä¼šè¿™æ ·æè¿°ï¼š
/*
æˆ‘éœ€è¦ä¸€ä¸ªå•†å“æœç´¢åŠŸèƒ½ï¼Œè¦æ±‚ï¼š
1. æ”¯æŒæ¨¡ç³Šæœç´¢
2. èƒ½æŒ‰ä»·æ ¼åŒºé—´ç­›é€‰
3. æ”¯æŒå¤šä¸ªåˆ†ç±»æ ‡ç­¾
4. ç»“æœéœ€è¦åˆ†é¡µ
5. è¦è€ƒè™‘æ€§èƒ½ä¼˜åŒ–
*/

// ç„¶å AI å°±èƒ½ç»™å‡ºæ›´ç¬¦åˆé¢„æœŸçš„ä»£ç ï¼š
const searchProducts = async ({
    keyword,
    priceRange,
    tags,
    page = 1,
    pageSize = 20
}) => {
    const query = {};
    
    // æ¨¡ç³Šæœç´¢
    if (keyword) {
        query.name = { $regex: keyword, $options: 'i' };
    }
    
    // ä»·æ ¼åŒºé—´
    if (priceRange) {
        query.price = {
            $gte: priceRange.min,
            $lte: priceRange.max
        };
    }
    
    // åˆ†ç±»æ ‡ç­¾
    if (tags?.length) {
        query.tags = { $in: tags };
    }
    
    // ä½¿ç”¨èšåˆç®¡é“ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
    return Product.aggregate([
        { $match: query },
        { $sort: { createdAt: -1 } },
        { $skip: (page - 1) * pageSize },
        { $limit: pageSize }
    ]).cache(300); // æ·»åŠ ç¼“å­˜
};
```

### 11.2.2 ç¬¬äºŒæ­¥ï¼šè®© AI å¸®ä½ ä¼˜åŒ–ä»£ç 

æœ‰æ—¶å€™ï¼ŒAI èƒ½å‘ç°ä¸€äº›ä½ æ²¡æ³¨æ„åˆ°çš„ä¼˜åŒ–ç©ºé—´ï¼š

```javascript
// åŸæ¥çš„ä»£ç 
function processData(data) {
    let result = [];
    for (let i = 0; i < data.length; i++) {
        if (data[i].status === 'active') {
            result.push(data[i]);
        }
    }
    return result;
}

// AI ä¼˜åŒ–åçš„ä»£ç 
const processData = (data) => 
    data.filter(item => item.status === 'active');
```

### 11.2.3 ç¬¬ä¸‰æ­¥ï¼šå®æˆ˜æ£€éªŒ

æ°¸è¿œè®°ä½ï¼šAI ç”Ÿæˆçš„ä»£ç éœ€è¦ç»è¿‡å®æˆ˜æ£€éªŒã€‚æˆ‘çš„ä¹ æƒ¯æ˜¯ï¼š

```javascript
// 1. å…ˆå†™æµ‹è¯•ç”¨ä¾‹
describe('å•†å“æœç´¢åŠŸèƒ½', () => {
    it('åº”è¯¥èƒ½æ­£ç¡®å¤„ç†ç©ºæœç´¢', async () => {
        const result = await searchProducts({});
        expect(result).toBeDefined();
        expect(result.length).toBeGreaterThanOrEqual(0);
    });
    
    it('åº”è¯¥èƒ½æŒ‰ä»·æ ¼åŒºé—´ç­›é€‰', async () => {
        const result = await searchProducts({
            priceRange: { min: 100, max: 200 }
        });
        result.forEach(item => {
            expect(item.price).toBeGreaterThanOrEqual(100);
            expect(item.price).toBeLessThanOrEqual(200);
        });
    });
});

// 2. è¿›è¡Œå‹åŠ›æµ‹è¯•
const loadTest = async () => {
    console.time('æœç´¢æ€§èƒ½æµ‹è¯•');
    await Promise.all(
        Array(1000).fill().map(() => 
            searchProducts({ keyword: 'æµ‹è¯•å•†å“' })
        )
    );
    console.timeEnd('æœç´¢æ€§èƒ½æµ‹è¯•');
};
```

### 11.2.4 æ€§èƒ½ä¼˜åŒ–å®è·µ

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ€§èƒ½å¾€å¾€æ˜¯ä¸€ä¸ªå¤§æŒ‘æˆ˜ã€‚è¿™é‡Œåˆ†äº«ä¸€äº›å’Œ AI é…åˆä¼˜åŒ–æ€§èƒ½çš„ç»éªŒï¼š

```javascript
// 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
const optimizedQuery = async () => {
    // ä½¿ç”¨ç´¢å¼•
    await Product.collection.createIndex({ name: 1, price: 1 });
    
    // ä½¿ç”¨æŠ•å½±
    const result = await Product.find(query)
        .select('name price tags')  // åªè¿”å›éœ€è¦çš„å­—æ®µ
        .lean()  // è¿”å›æ™®é€šå¯¹è±¡ï¼Œè€Œä¸æ˜¯ Mongoose æ–‡æ¡£
        .cache(60);  // æ·»åŠ ç¼“å­˜
        
    return result;
};

// 2. å¹¶å‘æ§åˆ¶
const rateLimitedAPI = async (requests) => {
    const limiter = new Bottleneck({
        maxConcurrent: 5,  // æœ€å¤§å¹¶å‘æ•°
        minTime: 100  // è¯·æ±‚é—´éš”
    });
    
    return Promise.all(
        requests.map(req => 
            limiter.schedule(() => processRequest(req))
        )
    );
};

// 3. å†…å­˜ä¼˜åŒ–
const streamProcess = async () => {
    const readable = fs.createReadStream('large-file.csv');
    const writeable = fs.createWriteStream('output.csv');
    
    return new Promise((resolve, reject) => {
        readable
            .pipe(csv())
            .pipe(transform(processRow))
            .pipe(writeable)
            .on('finish', resolve)
            .on('error', reject);
    });
};
```

## 11.3 è¸©å‘è®°å½•

è¯´å®è¯ï¼Œåœ¨ä½¿ç”¨ AI çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿè¸©è¿‡ä¸å°‘å‘ã€‚åˆ†äº«å‡ ä¸ªå°è±¡æ·±åˆ»çš„ï¼š

### 11.3.1 å‘ä¸€ï¼šè¿‡åº¦ä¾èµ–

åˆšå¼€å§‹æ—¶ï¼Œæˆ‘æ€»æ˜¯æƒ³è®© AI ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰ä»£ç ï¼Œç»“æœå¾€å¾€æ˜¯ï¼š

```javascript
// AI ç”Ÿæˆçš„"å®Œç¾"ä»£ç 
const doEverything = async () => {
    // 1000è¡Œä»£ç è¯•å›¾å¤„ç†æ‰€æœ‰æƒ…å†µ
    // ç»“æœå°±æ˜¯ï¼šéš¾ä»¥ç»´æŠ¤ï¼Œéš¾ä»¥æµ‹è¯•ï¼Œéš¾ä»¥æ‰©å±•
};

// æ­£ç¡®çš„åšæ³•ï¼šåˆ†è€Œæ²»ä¹‹
const userService = {
    register: async () => { /* ä¸“æ³¨æ³¨å†Œé€»è¾‘ */ },
    login: async () => { /* ä¸“æ³¨ç™»å½•é€»è¾‘ */ },
    resetPassword: async () => { /* ä¸“æ³¨é‡ç½®å¯†ç  */ }
};
```

### 11.3.2 å‘äºŒï¼šå¿½è§†å¼‚å¸¸å¤„ç†

AI ç”Ÿæˆçš„ä»£ç å¾€å¾€ç¼ºå°‘å®Œå–„çš„é”™è¯¯å¤„ç†ï¼š

```javascript
// âŒ AI åˆå§‹ç”Ÿæˆçš„ä»£ç 
async function fetchData() {
    const response = await axios.get('/api/data');
    return response.data;
}

// âœ… å®Œå–„åçš„ä»£ç 
async function fetchData() {
    try {
        const response = await axios.get('/api/data');
        return response.data;
    } catch (error) {
        if (error.response) {
            // å¤„ç†æœåŠ¡å™¨é”™è¯¯
            logger.error('æœåŠ¡å™¨å“åº”é”™è¯¯:', error.response.status);
            throw new AppError('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨', 503);
        } else if (error.request) {
            // å¤„ç†ç½‘ç»œé”™è¯¯
            logger.error('ç½‘ç»œè¯·æ±‚å¤±è´¥:', error.message);
            throw new AppError('ç½‘ç»œè¿æ¥å¤±è´¥', 500);
        } else {
            // å¤„ç†å…¶ä»–é”™è¯¯
            logger.error('æœªçŸ¥é”™è¯¯:', error.message);
            throw new AppError('ç³»ç»Ÿå¼‚å¸¸', 500);
        }
    }
}
```

### 11.3.3 å‘ä¸‰ï¼šä»£ç å¯ç»´æŠ¤æ€§

æœ‰æ—¶å€™ AI ç”Ÿæˆçš„ä»£ç è™½ç„¶èƒ½å·¥ä½œï¼Œä½†å¯ç»´æŠ¤æ€§å¾ˆå·®ï¼š

```javascript
// âŒ éš¾ä»¥ç»´æŠ¤çš„ä»£ç 
const processOrder = async (order) => {
    // æ‰€æœ‰é€»è¾‘å †åœ¨ä¸€èµ·
    const user = await User.findById(order.userId);
    const product = await Product.findById(order.productId);
    const inventory = await Inventory.findOne({ productId: order.productId });
    if (user.balance < product.price) throw new Error('ä½™é¢ä¸è¶³');
    if (inventory.stock < order.quantity) throw new Error('åº“å­˜ä¸è¶³');
    user.balance -= product.price;
    inventory.stock -= order.quantity;
    await user.save();
    await inventory.save();
    await Order.create({ ...order, status: 'success' });
};

// âœ… æ›´å¥½çš„ç»„ç»‡æ–¹å¼
const OrderService = {
    validateUser: async (userId, totalAmount) => {
        const user = await User.findById(userId);
        if (!user) throw new AppError('ç”¨æˆ·ä¸å­˜åœ¨', 404);
        if (user.balance < totalAmount) {
            throw new AppError('ä½™é¢ä¸è¶³', 400);
        }
        return user;
    },
    
    checkInventory: async (productId, quantity) => {
        const inventory = await Inventory.findOne({ productId });
        if (!inventory || inventory.stock < quantity) {
            throw new AppError('åº“å­˜ä¸è¶³', 400);
        }
        return inventory;
    },
    
    createTransaction: async (user, product, quantity) => {
        const session = await mongoose.startSession();
        session.startTransaction();
        
        try {
            // æ‰£å‡ä½™é¢
            user.balance -= product.price * quantity;
            await user.save({ session });
            
            // æ‰£å‡åº“å­˜
            await Inventory.updateOne(
                { productId: product._id },
                { $inc: { stock: -quantity } },
                { session }
            );
            
            // åˆ›å»ºè®¢å•
            const order = await Order.create([{
                userId: user._id,
                productId: product._id,
                quantity,
                status: 'success'
            }], { session });
            
            await session.commitTransaction();
            return order[0];
        } catch (error) {
            await session.abortTransaction();
            throw error;
        } finally {
            session.endSession();
        }
    }
};
```

### 11.3.4 å‘å››ï¼šå®‰å…¨æ€§é—®é¢˜

AI æœ‰æ—¶ä¼šç”Ÿæˆä¸€äº›ä¸å®‰å…¨çš„ä»£ç ï¼š

```javascript
// âŒ ä¸å®‰å…¨çš„å®ç°
app.get('/api/user', (req, res) => {
    const { id } = req.query;
    const query = `SELECT * FROM users WHERE id = ${id}`;  // SQLæ³¨å…¥é£é™©ï¼
    db.query(query).then(user => res.json(user));
});

// âœ… å®‰å…¨çš„å®ç°
app.get('/api/user', 
    authenticate,  // èº«ä»½éªŒè¯
    validate(userSchema),  // å‚æ•°éªŒè¯
    async (req, res) => {
        const { id } = req.query;
        const user = await User.findById(id);
        // åªè¿”å›å®‰å…¨çš„ç”¨æˆ·ä¿¡æ¯
        const safeUser = _.pick(user, ['id', 'name', 'email']);
        res.json(safeUser);
    }
);
```

## 11.4 æœ€ä½³å®è·µæ€»ç»“

ç»è¿‡è¿™ä¹ˆå¤šå®æˆ˜ç»éªŒï¼Œæˆ‘æ€»ç»“å‡ºäº†å’Œ AI é…åˆçš„å‡ ä¸ªé»„é‡‘æ³•åˆ™ï¼š

### 11.4.1 ä»£ç è´¨é‡æ§åˆ¶

1. **ä»£ç é£æ ¼ç»Ÿä¸€**
```javascript
// é…ç½® ESLint
module.exports = {
    extends: [
        'eslint:recommended',
        'plugin:@typescript-eslint/recommended'
    ],
    rules: {
        'no-console': ['error', { allow: ['warn', 'error'] }],
        'prefer-const': 'error',
        'no-var': 'error'
    }
};

// é…ç½® Prettier
module.exports = {
    semi: true,
    trailingComma: 'es5',
    singleQuote: true,
    printWidth: 80,
    tabWidth: 2
};
```

2. **å•å…ƒæµ‹è¯•è¦†ç›–**
```javascript
// ä½¿ç”¨ Jest è¿›è¡Œæµ‹è¯•
describe('UserService', () => {
    describe('register', () => {
        it('should create new user', async () => {
            const userData = {
                email: 'test@example.com',
                password: 'password123'
            };
            
            const user = await UserService.register(userData);
            
            expect(user).toBeDefined();
            expect(user.email).toBe(userData.email);
            expect(user.password).not.toBe(userData.password); // å¯†ç åº”è¯¥è¢«åŠ å¯†
        });
        
        it('should throw error for duplicate email', async () => {
            // æµ‹è¯•é‡å¤æ³¨å†Œåœºæ™¯
            await expect(
                UserService.register(existingUserData)
            ).rejects.toThrow('é‚®ç®±å·²è¢«æ³¨å†Œ');
        });
    });
});
```

### 11.4.2 æ€§èƒ½ä¼˜åŒ–å‡†åˆ™

1. **ç¼“å­˜ç­–ç•¥**
```javascript
// Redis ç¼“å­˜å®ç°
const cacheService = {
    async get(key) {
        const cached = await redis.get(key);
        return cached ? JSON.parse(cached) : null;
    },
    
    async set(key, value, ttl = 3600) {
        await redis.set(
            key,
            JSON.stringify(value),
            'EX',
            ttl
        );
    }
};

// ä½¿ç”¨ç¼“å­˜
const getProductDetails = async (productId) => {
    const cacheKey = `product:${productId}`;
    
    // å°è¯•ä»ç¼“å­˜è·å–
    const cached = await cacheService.get(cacheKey);
    if (cached) return cached;
    
    // ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è·å–
    const product = await Product.findById(productId);
    
    // å­˜å…¥ç¼“å­˜
    await cacheService.set(cacheKey, product);
    
    return product;
};
```

2. **æ•°æ®åº“ä¼˜åŒ–**
```javascript
// åˆ›å»ºåˆé€‚çš„ç´¢å¼•
db.products.createIndex({ name: "text" });  // å…¨æ–‡ç´¢å¼•
db.orders.createIndex({ userId: 1, createdAt: -1 });  // å¤åˆç´¢å¼•

// ä½¿ç”¨æŠ•å½±
const getOrderSummary = async (userId) => {
    return Order.find({ userId })
        .select('orderId total status')  // åªè·å–éœ€è¦çš„å­—æ®µ
        .sort({ createdAt: -1 })
        .limit(10);
};
```

### 11.4.3 ä»£ç å¤ç”¨ä¸æ¨¡å—åŒ–

1. **é€šç”¨å·¥å…·å‡½æ•°**
```javascript
// é€šç”¨çš„å¼‚æ­¥å¤„ç†åŒ…è£…å™¨
const asyncHandler = (fn) => (req, res, next) =>
    Promise.resolve(fn(req, res, next)).catch(next);

// é€šç”¨çš„å“åº”æ ¼å¼åŒ–
const formatResponse = (data, message = 'success') => ({
    code: 0,
    data,
    message
});

// é€šç”¨çš„åˆ†é¡µå¤„ç†
const paginate = async (model, query, page = 1, limit = 10) => {
    const skip = (page - 1) * limit;
    const [data, total] = await Promise.all([
        model.find(query).skip(skip).limit(limit),
        model.countDocuments(query)
    ]);
    
    return {
        data,
        pagination: {
            current: page,
            pageSize: limit,
            total
        }
    };
};
```

2. **ä¸­é—´ä»¶å°è£…**
```javascript
// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
const checkPermission = (requiredRole) => async (req, res, next) => {
    try {
        const user = req.user;
        if (!user) {
            throw new AppError('æœªç™»å½•', 401);
        }
        
        if (!user.roles.includes(requiredRole)) {
            throw new AppError('æƒé™ä¸è¶³', 403);
        }
        
        next();
    } catch (error) {
        next(error);
    }
};

// å‚æ•°éªŒè¯ä¸­é—´ä»¶
const validateRequest = (schema) => (req, res, next) => {
    const { error } = schema.validate(req.body);
    if (error) {
        throw new AppError(error.details[0].message, 400);
    }
    next();
};
```

## 11.5 ä¸ AI ç»“å¯¹ç¼–ç¨‹çš„è‰ºæœ¯

åœ¨å®è·µä¸­ï¼Œæˆ‘å‘ç°ä¸ AI ç»“å¯¹ç¼–ç¨‹æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦æŒæ¡ä»¥ä¸‹å‡ ç‚¹ï¼š

### 11.5.1 æ¸…æ™°çš„éœ€æ±‚æè¿°

```javascript
// âŒ æ¨¡ç³Šçš„éœ€æ±‚æè¿°
// "æˆ‘éœ€è¦ä¸€ä¸ªå¤„ç†ç”¨æˆ·æ•°æ®çš„å‡½æ•°"

// âœ… æ¸…æ™°çš„éœ€æ±‚æè¿°
/*
æˆ‘éœ€è¦ä¸€ä¸ªç”¨æˆ·æ•°æ®å¤„ç†å‡½æ•°ï¼Œè¦æ±‚ï¼š
1. è¾“å…¥ï¼šç”¨æˆ·åŸå§‹æ•°æ®ï¼ˆåŒ…å«å§“åã€é‚®ç®±ã€å¹´é¾„ï¼‰
2. å¤„ç†ï¼š
   - éªŒè¯é‚®ç®±æ ¼å¼
   - ç¡®ä¿å¹´é¾„åœ¨ 18-120 ä¹‹é—´
   - å§“åå»é™¤é¦–å°¾ç©ºæ ¼
3. è¾“å‡ºï¼šå¤„ç†åçš„ç”¨æˆ·æ•°æ®æˆ–é”™è¯¯ä¿¡æ¯
*/
```

### 11.5.2 æ¸è¿›å¼å¼€å‘

ä¸è¦æœŸå¾…ä¸€æ¬¡æ€§å¾—åˆ°å®Œç¾ä»£ç ï¼Œè€Œæ˜¯å¾ªåºæ¸è¿›ï¼š

1. **å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½**
```javascript
// ç¬¬ä¸€æ­¥ï¼šåŸºç¡€åŠŸèƒ½
const processUser = (userData) => {
    const { name, email, age } = userData;
    return {
        name: name.trim(),
        email,
        age
    };
};
```

2. **æ·»åŠ éªŒè¯é€»è¾‘**
```javascript
// ç¬¬äºŒæ­¥ï¼šæ·»åŠ éªŒè¯
const processUser = (userData) => {
    const { name, email, age } = userData;
    
    if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
        throw new Error('Invalid email format');
    }
    
    if (age < 18 || age > 120) {
        throw new Error('Age must be between 18 and 120');
    }
    
    return {
        name: name.trim(),
        email,
        age
    };
};
```

3. **ä¼˜åŒ–é”™è¯¯å¤„ç†**
```javascript
// ç¬¬ä¸‰æ­¥ï¼šå®Œå–„é”™è¯¯å¤„ç†
const processUser = (userData) => {
    try {
        const { name, email, age } = userData;
        
        const errors = [];
        
        if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
            errors.push('Invalid email format');
        }
        
        if (age < 18 || age > 120) {
            errors.push('Age must be between 18 and 120');
        }
        
        if (errors.length > 0) {
            throw new ValidationError(errors);
        }
        
        return {
            name: name.trim(),
            email,
            age
        };
    } catch (error) {
        logger.error('User processing failed:', error);
        throw error;
    }
};
```

### 11.5.3 ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ–

è®© AI å¸®ä½ å®¡æŸ¥ä»£ç ï¼Œæ‰¾å‡ºæ½œåœ¨é—®é¢˜ï¼š

```javascript
// åŸå§‹ä»£ç 
const processOrders = async (orders) => {
    for (let order of orders) {
        await processOrder(order);
    }
};

// AI ä¼˜åŒ–å»ºè®®ï¼š
// 1. è€ƒè™‘å¹¶å‘å¤„ç†
const processOrders = async (orders) => {
    const batchSize = 5;
    for (let i = 0; i < orders.length; i += batchSize) {
        const batch = orders.slice(i, i + batchSize);
        await Promise.all(batch.map(processOrder));
    }
};

// 2. æ·»åŠ é”™è¯¯å¤„ç†
const processOrders = async (orders) => {
    const results = {
        success: [],
        failed: []
    };
    
    const batchSize = 5;
    for (let i = 0; i < orders.length; i += batchSize) {
        const batch = orders.slice(i, i + batchSize);
        const batchResults = await Promise.allSettled(
            batch.map(processOrder)
        );
        
        batchResults.forEach((result, index) => {
            if (result.status === 'fulfilled') {
                results.success.push(batch[index]);
            } else {
                results.failed.push({
                    order: batch[index],
                    error: result.reason
                });
            }
        });
    }
    
    return results;
};
```

## 11.6 æœªæ¥å±•æœ›

åœ¨ä½¿ç”¨ AI ç¼–ç¨‹åŠ©æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ·±æ·±ä½“ä¼šåˆ°å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼Œæ›´æ˜¯ä¸€ä¸ªèƒ½åŠ›å€å¢å™¨ã€‚å±•æœ›æœªæ¥ï¼Œæˆ‘è®¤ä¸º AI ç¼–ç¨‹åŠ©æ‰‹å°†åœ¨ä»¥ä¸‹æ–¹é¢å‘æŒ¥æ›´å¤§ä½œç”¨ï¼š

1. **ä»£ç é‡æ„**ï¼šæ™ºèƒ½è¯†åˆ«ä»£ç åå‘³é“ï¼Œæä¾›é‡æ„å»ºè®®
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šè‡ªåŠ¨åˆ†ææ€§èƒ½ç“¶é¢ˆï¼Œæä¾›ä¼˜åŒ–æ–¹æ¡ˆ
3. **å®‰å…¨å®¡è®¡**ï¼šæ£€æµ‹æ½œåœ¨çš„å®‰å…¨æ¼æ´ï¼Œæä¾›ä¿®å¤å»ºè®®
4. **æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå…¨é¢çš„æµ‹è¯•ç”¨ä¾‹
5. **æ–‡æ¡£ç”Ÿæˆ**ï¼šæ ¹æ®ä»£ç è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡æ–‡æ¡£

## 11.7 æ€»ç»“

ç»è¿‡è¿™ä¹ˆå¤šå®æˆ˜ç»éªŒï¼Œæˆ‘æ€»ç»“å‡ºäº†å’Œ AI é…åˆçš„å‡ ä¸ªé»„é‡‘æ³•åˆ™ï¼š

1. **å¾ªåºæ¸è¿›**ï¼šä¸è¦æœŸå¾…ä¸€æ¬¡æ€§å¾—åˆ°å®Œç¾ä»£ç 
2. **åˆ†è€Œæ²»ä¹‹**ï¼šæŠŠå¤§é—®é¢˜æ‹†è§£æˆå°é—®é¢˜
3. **éªŒè¯ä¸ºç‹**ï¼šå§‹ç»ˆä¿æŒæ€€ç–‘æ€åº¦ï¼ŒéªŒè¯æ¯ä¸€è¡Œä»£ç 
4. **æŒç»­ä¼˜åŒ–**ï¼šæŠŠ AI å½“ä½œä½ çš„ä»£ç å®¡æŸ¥å‘˜
5. **å®‰å…¨è‡³ä¸Š**ï¼šæ—¶åˆ»å…³æ³¨ä»£ç çš„å®‰å…¨æ€§
6. **å¯ç»´æŠ¤æ€§**ï¼šå†™å‡ºå®¹æ˜“ç»´æŠ¤çš„ä»£ç 
7. **æ€§èƒ½ä¼˜åŒ–**ï¼šåœ¨é€‚å½“çš„æ—¶å€™è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

æœ€åï¼Œé€å¤§å®¶ä¸€å¥è¯ï¼šAI ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½†å–„ç”¨ AI æ˜¯ä¸€ç§èƒ½åŠ›ã€‚å¸Œæœ›æˆ‘çš„ç»éªŒèƒ½å¸®åŠ©ä½ åœ¨ AI ç¼–ç¨‹çš„é“è·¯ä¸Šå°‘èµ°ä¸€äº›å¼¯è·¯ã€‚

---
[å›åˆ°ç›®å½•](Readme.md)

ä¸Šä¸€ç« ï¼š[ç¬¬åç« -AIç¼–ç¨‹çš„æœªæ¥å±•æœ›](ç¬¬åç« -AIç¼–ç¨‹çš„æœªæ¥å±•æœ›.md)

ä¸‹ä¸€ç« ï¼š[ç¬¬åäºŒç« -CursoråŠŸèƒ½è¯¦è§£](ç¬¬åäºŒç« -CursoråŠŸèƒ½è¯¦è§£.md)
